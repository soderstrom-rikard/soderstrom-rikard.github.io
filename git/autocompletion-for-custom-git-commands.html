
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Autocompletion for custom git commands &#8212; soderstrom-rikard.github.io 1.0.rc1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Publishing sphinx generated documents on github" href="publishing-sphinx-generated-docs-on-github-pages.html" />
    <link rel="prev" title="&lt;no title&gt;" href="index.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="autocompletion-for-custom-git-commands">
<h1>Autocompletion for custom git commands<a class="headerlink" href="#autocompletion-for-custom-git-commands" title="Permalink to this heading">¶</a></h1>
<p>Custom git commands, or git extensions, can be used to make highly specialized commands for the project
you are currently working in. This is great and all, but they do not have autocompletion as normal git commands.</p>
<p>So let us fix that.</p>
<section id="complete-compgen-utilities">
<h2>complete &amp; compgen utilities<a class="headerlink" href="#complete-compgen-utilities" title="Permalink to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">compgen</span></code> is responsible for generating a list of matches given some options,
while <code class="docutils literal notranslate"><span class="pre">complete</span></code> specifies how any argument to a given match should be completed.</p>
<p>Essentially <code class="docutils literal notranslate"><span class="pre">compgen</span></code> says, hey dude, I got this list of matches for you, and then <code class="docutils literal notranslate"><span class="pre">complete</span></code> say, oh really?
Well for that match I have the following arguments for you to begin matching against.</p>
<p><code class="docutils literal notranslate"><span class="pre">complete</span></code> and <code class="docutils literal notranslate"><span class="pre">compgen</span></code> share the following options <code class="docutils literal notranslate"><span class="pre">abcdefgjksuv]</span></code>.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-a</span></code> Names of Alias</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-b</span></code> Names of Builtins (shell)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-c</span></code> Names of Commands (all available commands in your path)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-d</span></code> Names of Directory</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-e</span></code> Names of Exported shell variables</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-f</span></code> Names of Files and Functions</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-g</span></code> Names of Groups</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-j</span></code> Names of Job</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-k</span></code> Names of Keywords reserved by the shell</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-s</span></code> Names of Services</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-u</span></code> Names of Users</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-v</span></code> Names of Variables (none exported shell variables)</p></li>
</ul>
<section id="compgen">
<h3>compgen<a class="headerlink" href="#compgen" title="Permalink to this heading">¶</a></h3>
<p>From the little intro we have learned that <code class="docutils literal notranslate"><span class="pre">compgen</span></code> somehow creates some list of matches.
With the options staring us in or face it becomes rather easy. For example, <code class="docutils literal notranslate"><span class="pre">compgen</span> <span class="pre">-b</span></code> will return the complete
list of all builtin shell commands, one item per line. That’s it. It is yours, to do what every you wish to do with.</p>
<p>For example filter it.</p>
</section>
<section id="complete">
<h3>complete<a class="headerlink" href="#complete" title="Permalink to this heading">¶</a></h3>
<p>Let us start simple and with an example.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">complete</span><span class="w"> </span>-W<span class="w"> </span><span class="s1">&#39;-a -b ..&#39;</span><span class="w"> </span><span class="nb">compgen</span>
</pre></div>
</div>
<p>From the manual <a class="footnote-reference brackets" href="#bash-manual" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> we see that <code class="docutils literal notranslate"><span class="pre">-W</span></code> causes any word in the following string to be used as completions.
So in the above example when we type <em>compgen &lt;TAB&gt;&lt;TAB&gt;</em> the following line get printed in the console.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="o">-</span><span class="n">a</span> <span class="o">-</span><span class="n">b</span>
</pre></div>
</div>
<p>If we type <em>-</em> then <em>..</em> is removed from the line. Perfect, we have autocompletion.
But that isn’t very interesting. Instead we are going to register a function that will return the matches for us.</p>
<p>Before that, there are some things we should know. In the environment the function is run, there are some environmental
variables available for us. These are:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Variable</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">COMP_WORDS</span></code></p></td>
<td><p>A bash array containing each individual word of the current line</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">COMP_CWORD</span></code></p></td>
<td><p>The index in <code class="docutils literal notranslate"><span class="pre">COMP_WORDS</span></code> that contains the word under the cursor</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">COMP_WORDS[COMP_CWORD]</span></code></p></td>
<td><p>Word under the cursor</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">COMP_REPLY</span></code></p></td>
<td><p>Returns the possible completions back to <code class="docutils literal notranslate"><span class="pre">complete</span></code></p></td>
</tr>
</tbody>
</table>
<p>Now we have our building blocks. So let us do something silly. Everytime compgen is the command.
Return the previously written word when pressing tab.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>_previous<span class="o">()</span>
<span class="o">{</span>
<span class="w">    </span><span class="nv">COMPREPLY</span><span class="o">=(</span><span class="si">${</span><span class="nv">COMP_WORDS</span><span class="p">[COMP_CWORD-1]</span><span class="si">}</span><span class="o">)</span>
<span class="o">}</span>

<span class="nb">complete</span><span class="w"> </span>-F<span class="w"> </span>_previous<span class="w"> </span><span class="nb">compgen</span>
</pre></div>
</div>
<p>But how do we signal that its time to stop?
One way is to return a non zero exit status. This will however inform bash that something is wrong, ie probably not
what we want to do. Instead we need to return an empty <code class="docutils literal notranslate"><span class="pre">COMPREPLY</span></code>. So a simple if something, else something would
suffice.</p>
<section id="clearing-completions-for-a-certain-command">
<h4>Clearing completions for a certain command<a class="headerlink" href="#clearing-completions-for-a-certain-command" title="Permalink to this heading">¶</a></h4>
<p>In order to clear the completions for a command, it needs to be registered with the <code class="docutils literal notranslate"><span class="pre">-r</span></code> option.
So to clear completions for <code class="docutils literal notranslate"><span class="pre">compgen</span></code>, do</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">complete</span><span class="w"> </span>-r<span class="w"> </span><span class="nb">compgen</span>
</pre></div>
</div>
</section>
<section id="listing-all-registered-completions">
<h4>Listing all registered completions<a class="headerlink" href="#listing-all-registered-completions" title="Permalink to this heading">¶</a></h4>
<p>What if we forgot or are interested in knowing how a certain command performs autocompletion.
Well that is also simple, just run the <code class="docutils literal notranslate"><span class="pre">complete</span></code> command without any arguments, like so</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">complete</span>
</pre></div>
</div>
<p>This is the same as supplying the <code class="docutils literal notranslate"><span class="pre">-p</span></code> option, p for print.</p>
</section>
</section>
</section>
<section id="git-comlete-wrappers">
<h2>git comlete wrappers<a class="headerlink" href="#git-comlete-wrappers" title="Permalink to this heading">¶</a></h2>
<p>Git is extensible and modular, so it already have a way to map your “<em>git custom command</em>”. Git essentially searches
for any command in PATH (or current directory) starting with <em>git-</em> and registers the function
<code class="docutils literal notranslate"><span class="pre">_git_YOUR_CUSTOM_COMMAND</span></code>  with <code class="docutils literal notranslate"><span class="pre">complete</span></code> if you have created that function. This is done
on the fly (in one or more subshells), so we never actually see these registration.
But this is really nice, since all we need to do is ensure that git finds your script and your bash function.
And voila! autocompletions in git is here.</p>
<p>To show this, let’s create an empty executable in a temporary folder, add it to our path and re-read the git
completion file. Then simply define a ridicolous function with any dashes replaced with an underscore.
Voila! git autocompletion for a custom command</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="nv">TMP</span><span class="o">=</span><span class="sb">`</span>mktemp<span class="w"> </span>-d<span class="sb">`</span><span class="w">                                     </span><span class="c1"># Create tmp dir</span>
<span class="w"> </span>touch<span class="w"> </span><span class="nv">$TMP</span>/git-custom-command<span class="w">                       </span><span class="c1"># In tmp dir add file git-custom-command</span>
<span class="w"> </span>chmod<span class="w"> </span>u+x<span class="w"> </span><span class="nv">$TMP</span>/git-custom-command<span class="w">                   </span><span class="c1"># Make it executable</span>
<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$TMP</span>:<span class="nv">$PATH</span><span class="w">                              </span><span class="c1"># Place it in your path</span>
<span class="w"> </span><span class="nb">source</span><span class="w"> </span>/usr/share/bash-completion/completions/git<span class="w">   </span><span class="c1"># Re-read completions (or start a subshell)</span>
<span class="hll"><span class="w"> </span>_git_custom_command<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="nv">COMPREPLY</span><span class="o">=(</span><span class="s2">&quot;c1 c2&quot;</span><span class="o">)</span><span class="p">;</span><span class="w"> </span><span class="o">}</span><span class="w">      </span><span class="c1"># Create your autocompletion function</span>
</span><span class="hll"><span class="w"> </span>git<span class="w"> </span>custom-command&lt;TAB&gt;&lt;TAB&gt;<span class="w">                        </span><span class="c1"># Autocomplete !</span>
</span><span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span><span class="nv">$TMP</span><span class="w">                                         </span><span class="c1"># Clean up your mess</span>
</pre></div>
</div>
<section id="git-compgen-wrappers">
<h3>git compgen wrappers<a class="headerlink" href="#git-compgen-wrappers" title="Permalink to this heading">¶</a></h3>
<p>If you type <em>__git&lt;TAB&gt;&lt;TAB&gt;</em> and you will find a list of a number of internal git functions. Generated by git
completions script. There are a lot of them here. So let us focus on a few of them.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>git bash function</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">__gitcomp</span></code></p></td>
<td><p>Generates a <code class="docutils literal notranslate"><span class="pre">COMPREPLY</span></code> from space,tab or newline seperated list</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">__gitcomp_nl</span></code></p></td>
<td><p>Creates an empty <code class="docutils literal notranslate"><span class="pre">COMPREPLY</span></code> and fills it from newline seperated words</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">__git_complete</span></code></p></td>
<td><p>Creates custom command completions, as shown in previous example</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">__gitdir</span></code></p></td>
<td><p>Gives the path to current repository <em>.git</em> folder</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">__git_find_on_cmdline</span></code></p></td>
<td><p>Returns subcommand if it is present on the command line</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">__git_heads</span></code></p></td>
<td><p>List all available branches</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">__git_list_all_commands</span></code></p></td>
<td><p>Ask git to tell us which commands exists</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">__git_list_porcelain_commands</span></code></p></td>
<td><p>Filter out plumbing commands and return the user friendly ones</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">__git_main</span></code></p></td>
<td><p>Bind everything together to generate proper autocompletions for git</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">__git_refs</span></code></p></td>
<td><p>List all references (heads, remotes, tags etc)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">__git_remotes</span></code></p></td>
<td><p>List all remotes</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">__git_tags</span></code></p></td>
<td><p>List all tags</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">__git_wrap__git_main</span></code></p></td>
<td><p>This is the function that gets mapped to <code class="docutils literal notranslate"><span class="pre">complete</span></code></p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="final-notes">
<h2>Final notes<a class="headerlink" href="#final-notes" title="Permalink to this heading">¶</a></h2>
<p>Finally I would like to thank the authors of the bash manual. It helps a lot in understanding everything.
We all have our own way to learn, and I do not believe this guide could have been written in 4 hours without the help
of the others behind the references <a class="footnote-reference brackets" href="#bash-manual" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>, <a class="footnote-reference brackets" href="#git-bash-completion" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>, <a class="footnote-reference brackets" href="#compgen-stackoverflow" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a>,
<a class="footnote-reference brackets" href="#compgen-server-tutorials" id="id5" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a>, <a class="footnote-reference brackets" href="#custom-completions" id="id6" role="doc-noteref"><span class="fn-bracket">[</span>5<span class="fn-bracket">]</span></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">_git_YOUR_CUSTOM_GIT_COMMAND</span> <span class="p">()</span>
<span class="p">{</span>
  <span class="n">COMPREPLY</span><span class="p">(</span><span class="s2">&quot;Hello world&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Let your imagination take you away to that magic place.</p>
<p class="rubric">References</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="bash-manual" role="note">
<span class="label"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id1">1</a>,<a role="doc-backlink" href="#id2">2</a>)</span>
<p><a class="reference external" href="https://www.gnu.org/software/bash/manual/bash.html#Programmable-Completion-Builtins">https://www.gnu.org/software/bash/manual/bash.html#Programmable-Completion-Builtins</a></p>
</aside>
<aside class="footnote brackets" id="git-bash-completion" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">2</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://github.com/git/git/blob/master/contrib/completion/git-completion.bash">https://github.com/git/git/blob/master/contrib/completion/git-completion.bash</a></p>
</aside>
<aside class="footnote brackets" id="compgen-stackoverflow" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id4">3</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://unix.stackexchange.com/questions/151118/understand-compgen-builtin-command">https://unix.stackexchange.com/questions/151118/understand-compgen-builtin-command</a></p>
</aside>
<aside class="footnote brackets" id="compgen-server-tutorials" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id5">4</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="http://www.serverwatch.com/server-tutorials/a-look-at-the-compgen-bash-builtin.html">http://www.serverwatch.com/server-tutorials/a-look-at-the-compgen-bash-builtin.html</a></p>
</aside>
<aside class="footnote brackets" id="custom-completions" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id6">5</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="http://eli.thegreenplace.net/2013/12/26/adding-bash-completion-for-your-own-tools-an-example-for-pss">http://eli.thegreenplace.net/2013/12/26/adding-bash-completion-for-your-own-tools-an-example-for-pss</a></p>
</aside>
</aside>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">soderstrom-rikard.github.io</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=soderstrom-rikard&repo=soderstrom-rikard.github.io&type=follow&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../chip/community.html">The C.H.I.P Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chip/embedded-linux-development.html">Embedded Linux Development on C.H.I.P</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Autocompletion for custom git commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="publishing-sphinx-generated-docs-on-github-pages.html">Publishing sphinx generated documents on github</a></li>
<li class="toctree-l1"><a class="reference internal" href="rewriting-history-with-git-filter-branch.html">Rewriting history with git filter-branch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../linux/ssh-tunneling.html">Understanding Secure Shell Tunneling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../yocto/building-archlinuxarm-distro.html">Building Arch Linux ARM distribution in Yocto</a></li>
<li class="toctree-l1"><a class="reference internal" href="../yocto/virtual-targets.html">Working with Yocto virtual targets</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">&lt;no title&gt;</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">&lt;no title&gt;</a></li>
      <li>Next: <a href="publishing-sphinx-generated-docs-on-github-pages.html" title="next chapter">Publishing sphinx generated documents on github</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Rikard Söderström.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/git/autocompletion-for-custom-git-commands.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>