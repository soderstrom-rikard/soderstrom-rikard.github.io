<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Autocompletion for custom git commands &#8212; soderstrom-rikard.github.io 1.0.rc1 documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0.rc1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="&lt;no title&gt;" href="../yocto/index.html" />
    <link rel="prev" title="&lt;no title&gt;" href="index.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="autocompletion-for-custom-git-commands">
<h1>Autocompletion for custom git commands<a class="headerlink" href="#autocompletion-for-custom-git-commands" title="Permalink to this headline">¶</a></h1>
<p>Custom git commands, or git extensions, can be used to make highly specialized commands for the project
you are currently working in. This is great and all, but they do not have autocompletion as normal git commands.</p>
<p>So let us fix that.</p>
<div class="section" id="complete-compgen-utilities">
<h2>complete &amp; compgen utilities<a class="headerlink" href="#complete-compgen-utilities" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">compgen</span></code> is responsible for generating a list of matches given some options,
while <code class="docutils literal"><span class="pre">complete</span></code> specifies how any argument to a given match should be completed.</p>
<p>Essentially <code class="docutils literal"><span class="pre">compgen</span></code> says, hey dude, I got this list of matches for you, and then <code class="docutils literal"><span class="pre">complete</span></code> say, oh really?
Well for that match I have the following arguments for you to begin matching against.</p>
<p><code class="docutils literal"><span class="pre">complete</span></code> and <code class="docutils literal"><span class="pre">compgen</span></code> share the following options <code class="docutils literal"><span class="pre">abcdefgjksuv]</span></code>.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">-a</span></code> Names of Alias</li>
<li><code class="docutils literal"><span class="pre">-b</span></code> Names of Builtins (shell)</li>
<li><code class="docutils literal"><span class="pre">-c</span></code> Names of Commands (all available commands in your path)</li>
<li><code class="docutils literal"><span class="pre">-d</span></code> Names of Directory</li>
<li><code class="docutils literal"><span class="pre">-e</span></code> Names of Exported shell variables</li>
<li><code class="docutils literal"><span class="pre">-f</span></code> Names of Files and Functions</li>
<li><code class="docutils literal"><span class="pre">-g</span></code> Names of Groups</li>
<li><code class="docutils literal"><span class="pre">-j</span></code> Names of Job</li>
<li><code class="docutils literal"><span class="pre">-k</span></code> Names of Keywords reserved by the shell</li>
<li><code class="docutils literal"><span class="pre">-s</span></code> Names of Services</li>
<li><code class="docutils literal"><span class="pre">-u</span></code> Names of Users</li>
<li><code class="docutils literal"><span class="pre">-v</span></code> Names of Variables (none exported shell variables)</li>
</ul>
<div class="section" id="compgen">
<h3>compgen<a class="headerlink" href="#compgen" title="Permalink to this headline">¶</a></h3>
<p>From the little intro we have learned that <code class="docutils literal"><span class="pre">compgen</span></code> somehow creates some list of matches.
With the options staring us in or face it becomes rather easy. For example, <code class="docutils literal"><span class="pre">compgen</span> <span class="pre">-b</span></code> will return the complete
list of all builtin shell commands, one item per line. That&#8217;s it. It is yours, to do what every you wish to do with.</p>
<p>For example filter it.</p>
</div>
<div class="section" id="complete">
<h3>complete<a class="headerlink" href="#complete" title="Permalink to this headline">¶</a></h3>
<p>Let us start simple and with an example.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">complete</span> -W <span class="s1">&#39;-a -b ..&#39;</span> <span class="nb">compgen</span>
</pre></div>
</div>
<p>From the manual <a class="footnote-reference" href="#bash-manual" id="id1">[1]</a> we see that <code class="docutils literal"><span class="pre">-W</span></code> causes any word in the following string to be used as completions.
So in the above example when we type <em>compgen &lt;TAB&gt;&lt;TAB&gt;</em> the following line get printed in the console.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="o">-</span><span class="n">a</span> <span class="o">-</span><span class="n">b</span>
</pre></div>
</div>
<p>If we type <em>-</em> then <em>..</em> is removed from the line. Perfect, we have autocompletion.
But that isn&#8217;t very interesting. Instead we are going to register a function that will return the matches for us.</p>
<p>Before that, there are some things we should know. In the environment the function is run, there are some environmental
variables available for us. These are:</p>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Variable</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">COMP_WORDS</span></code></td>
<td>A bash array containing each individual word of the current line</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">COMP_CWORD</span></code></td>
<td>The index in <code class="docutils literal"><span class="pre">COMP_WORDS</span></code> that contains the word under the cursor</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">COMP_WORDS[COMP_CWORD]</span></code></td>
<td>Word under the cursor</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">COMP_REPLY</span></code></td>
<td>Returns the possible completions back to <code class="docutils literal"><span class="pre">complete</span></code></td>
</tr>
</tbody>
</table>
<p>Now we have our building blocks. So let us do something silly. Everytime compgen is the command.
Return the previously written word when pressing tab.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>_previous<span class="o">()</span>
<span class="o">{</span>
    <span class="nv">COMPREPLY</span><span class="o">=(</span><span class="si">${</span><span class="nv">COMP_WORDS</span><span class="p">[COMP_CWORD-1]</span><span class="si">}</span><span class="o">)</span>
<span class="o">}</span>

<span class="nb">complete</span> -F _previous <span class="nb">compgen</span>
</pre></div>
</div>
<p>But how do we signal that its time to stop?
One way is to return a non zero exit status. This will however inform bash that something is wrong, ie probably not
what we want to do. Instead we need to return an empty <code class="docutils literal"><span class="pre">COMPREPLY</span></code>. So a simple if something, else something would
suffice.</p>
<div class="section" id="clearing-completions-for-a-certain-command">
<h4>Clearing completions for a certain command<a class="headerlink" href="#clearing-completions-for-a-certain-command" title="Permalink to this headline">¶</a></h4>
<p>In order to clear the completions for a command, it needs to be registered with the <code class="docutils literal"><span class="pre">-r</span></code> option.
So to clear completions for <code class="docutils literal"><span class="pre">compgen</span></code>, do</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">complete</span> -r <span class="nb">compgen</span>
</pre></div>
</div>
</div>
<div class="section" id="listing-all-registered-completions">
<h4>Listing all registered completions<a class="headerlink" href="#listing-all-registered-completions" title="Permalink to this headline">¶</a></h4>
<p>What if we forgot or are interested in knowing how a certain command performs autocompletion.
Well that is also simple, just run the <code class="docutils literal"><span class="pre">complete</span></code> command without any arguments, like so</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">complete</span>
</pre></div>
</div>
<p>This is the same as supplying the <code class="docutils literal"><span class="pre">-p</span></code> option, p for print.</p>
</div>
</div>
</div>
<div class="section" id="git-comlete-wrappers">
<h2>git comlete wrappers<a class="headerlink" href="#git-comlete-wrappers" title="Permalink to this headline">¶</a></h2>
<p>Git is extensible and modular, so it already have a way to map your &#8220;<em>git custom command</em>&#8221;. Git essentially searches
for any command in PATH (or current directory) starting with <em>git-</em> and registers the function
<code class="docutils literal"><span class="pre">_git_YOUR_CUSTOM_COMMAND</span></code>  with <code class="docutils literal"><span class="pre">complete</span></code> if you have created that function. This is done
on the fly (in one or more subshells), so we never actually see these registration.
But this is really nice, since all we need to do is ensure that git finds your script and your bash function.
And voila! autocompletions in git is here.</p>
<p>To show this, let&#8217;s create an empty executable in a temporary folder, add it to our path and re-read the git
completion file. Then simply define a ridicolous function with any dashes replaced with an underscore.
Voila! git autocompletion for a custom command</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span> <span class="nv">TMP</span><span class="o">=</span><span class="sb">`</span>mktemp -d<span class="sb">`</span>                                     <span class="c1"># Create tmp dir</span>
 touch <span class="nv">$TMP</span>/git-custom-command                       <span class="c1"># In tmp dir add file git-custom-command</span>
 chmod u+x <span class="nv">$TMP</span>/git-custom-command                   <span class="c1"># Make it executable</span>
 <span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$TMP</span>:<span class="nv">$PATH</span>                              <span class="c1"># Place it in your path</span>
 <span class="nb">source</span> /usr/share/bash-completion/completions/git   <span class="c1"># Re-read completions (or start a subshell)</span>
<span class="hll"> _git_custom_command<span class="o">()</span> <span class="o">{</span> <span class="nv">COMPREPLY</span><span class="o">=(</span><span class="s2">&quot;c1 c2&quot;</span><span class="o">)</span><span class="p">;</span> <span class="o">}</span>      <span class="c1"># Create your autocompletion function</span>
</span><span class="hll"> git custom-command&lt;TAB&gt;&lt;TAB&gt;                        <span class="c1"># Autocomplete !</span>
</span> rm -rf <span class="nv">$TMP</span>                                         <span class="c1"># Clean up your mess</span>
</pre></div>
</div>
<div class="section" id="git-compgen-wrappers">
<h3>git compgen wrappers<a class="headerlink" href="#git-compgen-wrappers" title="Permalink to this headline">¶</a></h3>
<p>If you type <em>__git&lt;TAB&gt;&lt;TAB&gt;</em> and you will find a list of a number of internal git functions. Generated by git
completions script. There are a lot of them here. So let us focus on a few of them.</p>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="71%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">git bash function</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">__gitcomp</span></code></td>
<td>Generates a <code class="docutils literal"><span class="pre">COMPREPLY</span></code> from space,tab or newline seperated list</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">__gitcomp_nl</span></code></td>
<td>Creates an empty <code class="docutils literal"><span class="pre">COMPREPLY</span></code> and fills it from newline seperated words</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">__git_complete</span></code></td>
<td>Creates custom command completions, as shown in previous example</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">__gitdir</span></code></td>
<td>Gives the path to current repository <em>.git</em> folder</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">__git_find_on_cmdline</span></code></td>
<td>Returns subcommand if it is present on the command line</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">__git_heads</span></code></td>
<td>List all available branches</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">__git_list_all_commands</span></code></td>
<td>Ask git to tell us which commands exists</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">__git_list_porcelain_commands</span></code></td>
<td>Filter out plumbing commands and return the user friendly ones</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">__git_main</span></code></td>
<td>Bind everything together to generate proper autocompletions for git</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">__git_refs</span></code></td>
<td>List all references (heads, remotes, tags etc)</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">__git_remotes</span></code></td>
<td>List all remotes</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">__git_tags</span></code></td>
<td>List all tags</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">__git_wrap__git_main</span></code></td>
<td>This is the function that gets mapped to <code class="docutils literal"><span class="pre">complete</span></code></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="final-notes">
<h2>Final notes<a class="headerlink" href="#final-notes" title="Permalink to this headline">¶</a></h2>
<p>Finally I would like to thank the authors of the bash manual. It helps a lot in understanding everything.
We all have our own way to learn, and I do not believe this guide could have been written in 4 hours without the help
of the others behind the references <a class="footnote-reference" href="#bash-manual" id="id2">[1]</a>,[#GIT_BASH_COMPLETION]_,[#COMPGEN_STACKOVERFLOW]_,
<a class="footnote-reference" href="#compgen-server-tutorials" id="id3">[4]</a>,[#CUSTOM_COMPLETIONS]_</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">_git_YOUR_CUSTOM_GIT_COMMAND</span> <span class="p">()</span>
<span class="p">{</span>
  <span class="n">COMPREPLY</span><span class="p">(</span><span class="s2">&quot;Hello world&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Let your imagination take you away to that magic place.</p>
<p class="rubric">References</p>
<table class="docutils footnote" frame="void" id="bash-manual" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[1]</td><td><em>(<a class="fn-backref" href="#id1">1</a>, <a class="fn-backref" href="#id2">2</a>)</em> <a class="reference external" href="https://www.gnu.org/software/bash/manual/bash.html#Programmable-Completion-Builtins">https://www.gnu.org/software/bash/manual/bash.html#Programmable-Completion-Builtins</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="git-bash-completion" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[2]</td><td><a class="reference external" href="https://github.com/git/git/blob/master/contrib/completion/git-completion.bash">https://github.com/git/git/blob/master/contrib/completion/git-completion.bash</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="compgen-stackoverflow" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[3]</td><td><a class="reference external" href="https://unix.stackexchange.com/questions/151118/understand-compgen-builtin-command">https://unix.stackexchange.com/questions/151118/understand-compgen-builtin-command</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="compgen-server-tutorials" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[4]</a></td><td><a class="reference external" href="http://www.serverwatch.com/server-tutorials/a-look-at-the-compgen-bash-builtin.html">http://www.serverwatch.com/server-tutorials/a-look-at-the-compgen-bash-builtin.html</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="custom-completions" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[5]</td><td><a class="reference external" href="http://eli.thegreenplace.net/2013/12/26/adding-bash-completion-for-your-own-tools-an-example-for-pss">http://eli.thegreenplace.net/2013/12/26/adding-bash-completion-for-your-own-tools-an-example-for-pss</a></td></tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Autocompletion for custom git commands</a><ul>
<li><a class="reference internal" href="#complete-compgen-utilities">complete &amp; compgen utilities</a><ul>
<li><a class="reference internal" href="#compgen">compgen</a></li>
<li><a class="reference internal" href="#complete">complete</a><ul>
<li><a class="reference internal" href="#clearing-completions-for-a-certain-command">Clearing completions for a certain command</a></li>
<li><a class="reference internal" href="#listing-all-registered-completions">Listing all registered completions</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#git-comlete-wrappers">git comlete wrappers</a><ul>
<li><a class="reference internal" href="#git-compgen-wrappers">git compgen wrappers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#final-notes">Final notes</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">&lt;no title&gt;</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">&lt;no title&gt;</a></li>
      <li>Next: <a href="../yocto/index.html" title="next chapter">&lt;no title&gt;</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/git/autocompletion-for-custom-git-commands.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Rikard Söderström.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.5.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="../_sources/git/autocompletion-for-custom-git-commands.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>